\subsection{Determination of $\hat{m}_{\Pgt\Pgt}$}
\label{sec:mem_numericalMaximization}

The best estimate, $m_{\Pgt\Pgt}$, for the mass of the $\Pgt$ lepton pair in a given event
is obtained by computing the probability density $P(\bm{p}^{\vis(1)},\bm{p}^{\vis(2)};\pX^{\rec},\pY^{\rec}|m_{\PHiggs}^{\textrm{test}(i)})$ 
for a series of mass hypotheses $m_{\PHiggs}^{\textrm{test}(i)}$, using Eq.~(\ref{eq:mem_with_hadRecoil}), and determining the value of $m_{\PHiggs}$ that maximizes this probability density.
The integral in Eq.~(\ref{eq:mem_with_hadRecoil}) is evaluated numerically using the VAMP algorithm.
The series of mass hypotheses is defined by a recursive relation: 
\begin{equation}
m_{\PHiggs}^{\textrm{test}(i + 1)} = (1 + \delta) \,  m_{\PHiggs}^{\textrm{test}(i)} \, ,
\label{eq:mTauTau_step_size}
\end{equation}
The step size $\delta$ is chosen such that it is small compared to the expected $m_{\PHiggs}$ resolution,
typically amounting to $15$--$20\%$ relative to the true mass of the $\Pgt$ lepton pair.
In order to reduce the computing time, the series is computed in two passes.
The purpose of the first pass, which uses a step size of $\delta = 0.10$, is to find an approximate value of $m_{\Pgt\Pgt}$
that maximizes $P(\bm{p}^{\vis(1)},\bm{p}^{\vis(2)};\pX^{\rec},\pY^{\rec}|m_{\PHiggs}^{\textrm{test}(i)})$.
The series of mass hypotheses used in the first pass is started at $m_{\PHiggs}^{\textrm{test}(0)} = m_{\vis}$,
the mass of the visible $\Pgt$ decay products, 
and stops when $P(\bm{p}^{\vis(1)},\bm{p}^{\vis(2)};\pX^{\rec},\pY^{\rec}|m_{\PHiggs}^{\textrm{test}(i)})$ falls below one per mille 
of the maximal $P(\bm{p}^{\vis(1)},\bm{p}^{\vis(2)};\pX^{\rec},\pY^{\rec}|m_{\PHiggs}^{\textrm{test}(i)})$ value
computed so far for any $m_{\PHiggs}^{\textrm{test}(i)}$ in a given event.
In the second pass, further $P(\bm{p}^{\vis(1)},\bm{p}^{\vis(2)};\pX^{\rec},\pY^{\rec}|m_{\PHiggs}^{\textrm{test}(i)})$ values 
are computed for mass hypotheses $m_{\PHiggs}^{\textrm{test}(i)}$ that are within a region around the maximum,
using a step size of $\delta = 0.01$.
The probability densities $P(\bm{p}^{\vis(1)},\bm{p}^{\vis(2)};\pX^{\rec},\pY^{\rec}|m_{\PHiggs}^{\textrm{test}(i)})$ are multiplied by $\mbox{~GeV}^{8}$
to turn them into dimensionless quantities.
Finally, the graph of $\log \left( P(\bm{p}^{\vis(1)},\bm{p}^{\vis(2)};\pX^{\rec},\pY^{\rec}|m_{\PHiggs}^{\textrm{test}(i)}) \cdot \mbox{~GeV}^{8} \right)$ 
versus $m_{\PHiggs}^{\textrm{test}(i)}$ is fitted by a second order polynomial
in the region around the maximum,
and $m_{\Pgt\Pgt}$ is taken to be the point at which the polynomial reaches its maximum.
