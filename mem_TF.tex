\subsection{Transfer functions}
\label{sec:mem_TF}

The treatment of the experimental resolution on the momenta of electrons, muons and $\tauh$ produced in the $\Pgt$ decays,
as well as of the hadronic recoil, are detailed in this section.
The resolution on the momentum $\bm{p}^{\vis(i)}$ of the visible $\Pgt$ decay products is parametrized as function of the true momentum $\phat^{\vis(i)}$
and modeled by TF $W(\bm{p}^{\vis(i)}|\phat^{\vis(i)})$.
The case of hadronic and leptonic $\Pgt$ decays is described in
Sections~\ref{sec:mem_TF_tauToHadDecays}
and~\ref{sec:mem_TF_tauToLepDecays}, respectively.
The neutrinos produced in the $\Pgt$ decays are not
included in the TF, but are handled separately, by the formalism detailed in Sections~\ref{sec:appendix_tauToHadDecays} and~\ref{sec:appendix_tauToLepDecays} of the appendix.
The TF $W_{\rec}( \pX^{\rec},\pY^{\rec} | \pXhat^{\rec},\pYhat^{\rec} )$ that we use to model the experimental resolution on the
hadronic recoil is discussed in Section~\ref{sec:mem_TF_hadRecoil}.


\subsubsection{Hadronic $\Pgt$ decays}
\label{sec:mem_TF_tauToHadDecays}

The energy, or equivalently $\pT$, of the $\tauh$ 
is reconstructed with a
resolution of $5$--$25\%$ at the
LHC~\cite{Aad:2014rga,TAU-14-001}.
The resolution typically varies as function of $\pT$ and $\eta$ and may additionally depend
also on the multiplicity of the charged and neutral hadrons produced in the $\Pgt$ decay.
The resolution on the $\pT$ of the $\tauh$ is of similar magnitude as the
resolution on $m_{\Pgt\Pgt}$ that we aim to achieve and needs to be
taken into account by suitable TF,
denoted by $W_{\Phadron}( \bm{p}_{\T}^{\vis} | \phat_{\T}^{\vis} )$,
when evaluating the integral in Eq.~(\ref{eq:mem_with_hadRecoil}).

ATLAS as well as CMS report that the energy response for hadronic
$\Pgt$ decays may be asymmetric~\cite{ATLAS:2011tfa,PRF-14-001}.
For the purpose of this paper, we assume the TF $W_{\Phadron}( \bm{p}_{\T}^{\vis} | \phat_{\T}^{\vis} )$ 
to follow a Gaussian distribution within the core region $x = \pT^{\vis}/\pThat^{\vis} \approx 1$ and to feature non-Gaussian tails,
which follow power-law functions, on both sides of the Gaussian core.
More specifically, we use the form:
\begin{equation}
W_{\Phadron}( \pT^{\vis} | \pThat^{\vis} ) = 
 \begin{cases}
   \mathcal{N} \, \zeta_{1} \, \left( \frac{\alpha_{1}}{x_{1}} - x_{1} - \frac{x - \mu}{\sigma} \right)^{-\alpha_{1}} \,  
 & \mbox{if } x < x_{1} \\
   \mathcal{N} \, \exp\left( -\frac{1}{2} \, \left( \frac{x - \mu}{\sigma} \right)^{2} \right) \,
 & \mbox{if } x_{1} \leq x \leq x_{2} \\
   \mathcal{N} \, \zeta_{2} \, \left( \frac{\alpha_{2}}{x_{2}} - x_{2} - \frac{x - \mu}{\sigma} \right)^{-\alpha_{2}} \,
 & \mbox{if } x > x_{2} 
 \end{cases}
\label{eq:tf_tauToHadDecays_pT}
\end{equation}
and we use the values $\mu = 1.0$, $\sigma = 0.03$, $x_{1} = 0.97$, $\alpha_{1} = 7$,
$x_{2} = 1.03$, and $\alpha_{2} = 3.5$ for its parameters.
The factors $\zeta_{1}$ and $\zeta_{2}$ are chosen such that the
function $W_{\Phadron}( \pT^{\vis} | \pThat^{\vis} )$ is continuous at
the points $x = x_{1}$ and $x = x_{2}$. 
The corresponding values are 
$\zeta_{1} = \exp\left( -\frac{1}{2} \, \left( \frac{x_{1} - \mu}{\sigma} \right)^{2} \right) \cdot \left( \frac{\alpha_{1}}{x_{1}} - x_{1} - \frac{x_{1} - \mu}{\sigma} \right)^{\alpha_{1}}$
and
$\zeta_{2} = \exp\left( -\frac{1}{2} \, \left( \frac{x_{2} - \mu}{\sigma} \right)^{2} \right) \cdot \left( \frac{\alpha_{2}}{x_{2}} - x_{2} - \frac{x_{2} - \mu}{\sigma} \right)^{\alpha_{2}}$.
The factor $\mathcal{N}$ is determined by the requirement that the function $W_{\Phadron}( \pT^{\vis} | \pThat^{\vis} )$ 
satisfies the normalization condition $\int \, d\pT^{\vis} \, W_{\Phadron}( \pT^{\vis} | \pThat^{\vis} ) = 1$ for any given value of $\pThat^{\vis}$.
The TF given by Eq.~(\ref{eq:tf_tauToHadDecays_pT}) is visualized in Fig.~\ref{fig:tf_tauToHadDecays_pT}.

\begin{figure}
\setlength{\unitlength}{1mm}
\begin{center}
\begin{picture}(160,54)(0,0)
\put(-2.5, 0.0){\mbox{\includegraphics*[height=54mm]{figures/tf_tauToHadDecays_pT_linear.pdf}}}
\put(79.0, 0.0){\mbox{\includegraphics*[height=54mm]{figures/tf_tauToHadDecays_pT_log.pdf}}}
\end{picture}
\end{center}
\caption{
  TF $W_{\Phadron}( \bm{p}_{\T}^{\vis} | \phat_{\T}^{\vis} )$ that models the experimental resolution on the $\pT$ of the charged and neutral hadrons produced in $\Pgt$ decays,
  given by Eq.~(\ref{eq:tf_tauToHadDecays_pT}),
  in linear (left) and logarithmic (right) scale of the ordinate.
  The values of the function parameters $\mu$, $\sigma$, $x_{1}$, $\alpha_{1}$, $x_{2}$, and $\alpha_{2}$ are given in the figure.
}
\label{fig:tf_tauToHadDecays_pT}
\end{figure}

The resolution on the direction of the $\tauh$ is on the level
of a few milliradians and is negligible in practice.
We hence model the TF for the momentum of the $\tauh$ by the product of Eq.~(\ref{eq:tf_tauToHadDecays_pT}) and two
$\delta$-functions:
\begin{equation}
W_{\Phadron}( \bm{p}^{\vis} | \phat^{\vis} ) =
 \frac{\sin^{2}\theta_{\vis}}{\pT^{\vis}} \, 
  W_{\Phadron}( \pT^{\vis} | \pThat^{\vis} ) \,
  \delta( \theta_{\vis} - \thetahat_{\vis} ) \, 
  \delta( \phi_{\vis} - \phihat_{\vis} ) \, .
\label{eq:tf_tauToHadDecays}
\end{equation}
The factor $\sin^{2}\theta_{\vis}/\pT^{\vis}$ is needed
to ensure the correct normalization of the TF:
\begin{align}
& \int \, d^{3}\bm{p}  \, W_{\Phadron}( \bm{p}^{\vis} | \phat^{\vis} ) = \int \, d\pX^{\vis} \, d\pY^{\vis} \, d\pZ^{\vis} \, W_{\Phadron}( \bm{p}^{\vis} | \phat^{\vis} ) \nonumber \\
& \qquad = \int \, d\pT^{\vis} \, d\theta_{\vis} \, d\phi_{\vis} \,
\frac{\pT^{\vis}}{\sin^{2} \theta_{\vis}} \, W_{\Phadron}( \bm{p}^{\vis} | \phat^{\vis} ) \, 
  = 1 \, ,
\end{align}
where the factor $\pT^{\vis}/\sin^{2} \theta_{\vis}$ corresponds to the Jacobian of the variable transformation 
from $(\pX^{\vis} = \pT^{\vis} \, \cos\phi_{\vis}, \pY^{\vis} = \pT^{\vis} \, \sin\phi_{\vis}, \pZ^{\vis} = \pT^{\vis}/\tan\theta_{\vis})$ 
to $(\pT^{\vis}, \theta_{\vis}, \phi_{\vis})$.


\subsubsection{Leptonic $\Pgt$ decays}
\label{sec:mem_TF_tauToLepDecays}

We assume that the $\pT^{\vis}$, $\eta_{\vis}$, and $\phi_{\vis}$
of the electrons and muons produced in $\Pgt$ decays are measured with negligible experimental resolution.
Correspondingly, we model the TF by a product of three $\delta$-functions:
\begin{equation}
W_{\Plepton}( \bm{p}^{\vis} | \phat^{\vis} ) =  
 \frac{\sin^{2} \theta_{\vis}}{\pT^{\vis}} \, 
  \delta( \pT^{\vis} - \pThat^{\vis} ) \, 
  \delta( \theta_{\vis} - \thetahat_{\vis} ) \, 
  \delta( \phi_{\vis} - \phihat_{\vis} ) \, .
\label{eq:tf_tauToLepDecays}
\end{equation}


\subsubsection{Hadronic recoil}
\label{sec:mem_TF_hadRecoil}

We use a two-dimensional normal distribution:
\begin{align}
%%& W_{\rec}( \pX^{\rec},\pY^{\rec} | \pXhat^{\rec},\pYhat^{\rec} ) = \hspace{7cm} \nonumber \\
%%& \quad
%%  \frac{1}{2\pi \, \sqrt{\vert V \vert}} \, \exp \left( -\frac{1}{2}
%%  \left( \begin{array}{c} \Delta\pX^{\rec} \\ \Delta\pY^{\rec} \end{array} \right)^{T}
%%  \cdot V^{-1} \cdot
%%   \left( \begin{array}{c} \Delta\pX^{\rec} \\ \Delta\pY^{\rec} \end{array} \right)
%%  \right) \, ,
W_{\rec}( \pX^{\rec},\pY^{\rec} | \pXhat^{\rec},\pYhat^{\rec} ) = & 
  \frac{1}{2\pi \, \sqrt{\vert V \vert}} \, \exp \left( -\frac{1}{2}
  \left( \begin{array}{c} \Delta\pX^{\rec} \\ \Delta\pY^{\rec} \end{array} \right)^{T}
  \cdot V^{-1} \cdot
   \left( \begin{array}{c} \Delta\pX^{\rec} \\ \Delta\pY^{\rec} \end{array} \right)
  \right) \, ,
\label{eq:tf_hadRecoil}
\end{align}
to model the experimental resolution on the momentum, in the transverse plane, 
of the hadronic recoil.
The symbols:
\begin{equation}
\Delta\pX^{\rec} = \pX^{\rec} - \pXhat^{\rec} \quad \mbox{ and } \quad
\Delta\pY^{\rec} = \pY^{\rec} - \pYhat^{\rec} 
\label{eq:tf_hadRecoil_delta}
\end{equation}
refer to the difference between reconstructed and true values of the
momentum in $x$- and $y$-direction,
and the covariance matrix:
\begin{equation}
V = \left( \begin{array}{cc} \sigma_{x}^{2} & \rho \, \sigma_{x} \, \sigma_{y} \\ \rho \, \sigma_{x} \, \sigma_{y} & \sigma_{y}^{2} \end{array} \right) 
\label{eq:tf_hadRecoil_V}
\end{equation}
accounts for the fact that the resolutions $\sigma_{x}$ and $\sigma_{y}$ in $x$- and $y$-direction may be correlated,
with the correlation coefficient denoted by $\rho$.
The symbol $\vert V \vert$ denotes the determinant of $V$.
Two-dimensional normal distributions have been demonstrated to model well the resolution on $\vecMET$ in case of the CMS experiment~\cite{CMS-JME-13-003,CMS-JME-10-009}.
As explained in Section~\ref{sec:mem_hadRecoil}, the resolution on
$\pX^{\rec}$ and $\pY^{\rec}$ is very similar to the resolution on $\METx$ and $\METy$,
motivating the use of TF of the same type for the modelling of the experimental resolution on the hadronic recoil.

For the purpose of this paper,
we assume that the components $\pX^{\rec}$ and $\pY^{\rec}$ are reconstructed with a resolution of $\sigma_{x} = \sigma_{y} = 10$~\GeV each
and that the differences $\Delta\pX^{\rec}$ and $\Delta\pY^{\rec}$ 
between reconstructed and true values of both components are uncorrelated, \ie $\rho = 0$.
In the real experiment, the covariance matrix $V$ is computed on an
event-by-event basis, based on the reconstructed hadronic activity in a given event,
using resolution functions obtained from the Monte Carlo simulation~\cite{CMS-JME-13-003,CMS-JME-10-009}.
